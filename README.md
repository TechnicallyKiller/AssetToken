# Xaults Asset Token (UUPS Upgradeable)

This project implements a secure, upgradeable ERC-20 token for Xaults using the **UUPS (Universal Upgradeable Proxy Standard)** pattern. It features role-based access control, a capped supply, and a verified upgrade path to a Pausable V2 implementation.

## üìÇ Deliverables Structure

* **src/**: `AssetToken.sol` (V1) and `AssetTokenV2.sol` (V2)
* **script/**: `DeployAssetToken.s.sol` (Deployment Script)
* **test/**: `AssetToken.t.sol` (Lifecycle & Upgrade Tests)

## üèó Architecture

* **Pattern:** UUPS (Universal Upgradeable Proxy Standard)
* **Framework:** Foundry
* **Solidity Version:** ^0.8.20
* **Key Libraries:** OpenZeppelin Upgradeable Contracts (v5.0)

### Contracts
1.  **`AssetToken.sol` (V1):**
    * Standard ERC20 with `AccessControl`.
    * `s_maxSupply` enforced on minting (Storage Variable).
    * `DEFAULT_ADMIN_ROLE` required for `_authorizeUpgrade`.
    * **Security:** Initializers are disabled on the implementation contract to prevent direct takeover.

2.  **`AssetTokenV2.sol` (V2):**
    * Inherits `AssetToken` to preserve storage layout.
    * Adds `bool public paused` and `pause()`/`unpause()` logic.
    * Overrides `_update` to freeze transfers when paused.

##  Storage Layout Verification

To ensure the upgrade from V1 to V2 does not corrupt storage, we validated the layout using `forge inspect`.

* **V1 Layout:** 
  * AccessControl storage (inherited)
  * ERC20 storage (inherited)
  * `s_maxSupply` (user-defined variable)
  
* **V2 Layout:** 
  * All V1 storage (preserved)
  * `paused` (new variable appended at the end)

Since V2 appends new variables only at the end, storage collision risk is mitigated.

##  Setup & Testing

### Prerequisites
* Foundry (`forge`, `cast`, `anvil`)

### Installation
```bash
forge install
```

### Running Tests
The test suite validates the entire lifecycle: Deployment ‚Üí Minting ‚Üí Upgrade ‚Üí State Persistence ‚Üí New Logic.
```bash
forge test -vv
```

### Deployment (Localhost)
Start the local node:
```bash
anvil
```

Export one of the private keys generated by Anvil:
```bash
export PRIVATE_KEY=<ANVIL_PRIVATE_KEY>
```

Run the deployment script:
```bash
forge script script/DeployAssetToken.s.sol \
  --rpc-url http://127.0.0.1:8545 \
  --private-key $PRIVATE_KEY \
  --broadcast
```

Inspect Storage Post-Deployment:
```bash
forge inspect src/AssetTokenV2.sol:AssetTokenV2 storage 
echo "---------------------------------------------------"
forge inspect src/AssetToken.sol:AssetToken storage 
```

##  CLI Interaction (Manual Verification)

After deployment, you can verify the contract manually using `cast`.

### 1. Setup Variables
```bash
# Replace with the Proxy Address from your deployment logs
export PROXY=<YOUR_PROXY_ADDRESS>

# Replace with the Deployer Private Key (from Anvil)
export KEY=<YOUR_PRIVATE_KEY>

# A test user address
export USER=0x70997970C51812dc3A010C7d01b50e0d17dc79C8
```

### 2. Verify State (Read V1)
```bash
# Check Max Supply
cast call $PROXY "s_maxSupply()(uint256)" \
  --rpc-url http://127.0.0.1:8545
# Expected: 1000000000000000000000000000
```

### 3. Mint Tokens (Write)
```bash
# Mint 500 tokens to User
cast send $PROXY "mint(address,uint256)" $USER 500000000000000000000 \
  --private-key $KEY \
  --rpc-url http://127.0.0.1:8545
```

### 4. Verify Balance
```bash
cast call $PROXY "balanceOf(address)(uint256)" $USER \
  --rpc-url http://127.0.0.1:8545
# Expected: 500000000000000000000
```


##  Final Deliverables

1.   **Code:** `src/AssetToken.sol` and `src/AssetTokenV2.sol` are clean and compile.
2.   **Scripts:** `script/DeployAssetToken.s.sol` with the correct argument order (`Name, Symbol, Admin, Minter, Supply`).
3.   **Tests:** `forge test` passes with green logs.
4.   **Docs:** This `README.md` is in  root folder.

## üîê Security Notes

* Implementation contracts have initializers disabled via `_disableInitializers()` in the constructor
* Only `DEFAULT_ADMIN_ROLE` can authorize upgrades
* Max supply is enforced on every mint operation
* V2 pause functionality can only be triggered by admin

## üìù License

MIT